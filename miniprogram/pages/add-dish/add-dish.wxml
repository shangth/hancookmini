<view class="container">
  <!-- 自定义导航栏 -->
  <navigation-bar title="添加菜单" show-back="{{true}}" />
  
  <scroll-view scroll-y class="form-container">
    <view class="form-content">
      <!-- 菜品图片 -->
      <view class="form-group">
        <view class="form-label required">菜品图片</view>
        <view class="image-upload">
          <view wx:if="{{!formData.image_url}}" class="upload-btn" bindtap="chooseImage">
            <text class="upload-icon">📷</text>
            <text class="upload-text">点击上传图片</text>
          </view>
          <view wx:else class="image-preview">
            <image src="{{formData.image_url}}" mode="aspectFill" />
            <view class="image-remove" bindtap="removeImage">✕</view>
          </view>
        </view>
      </view>
      
      <!-- 菜品名称 -->
      <view class="form-group">
        <view class="form-label required">菜品名称</view>
        <input 
          class="form-input" 
          placeholder="请输入菜品名称" 
          value="{{formData.name}}" 
          bindinput="onInputName" 
          maxlength="50" 
        />
      </view>
      
      <!-- 菜品分类 -->
      <view class="form-group">
        <view class="form-label required">菜品分类</view>
        <picker mode="selector" range="{{categories}}" value="{{categoryIndex}}" bindchange="onCategoryChange">
          <view class="form-input picker-input">
            {{formData.category || '请选择分类'}}
          </view>
        </picker>
        <view class="category-actions">
          <text class="link-text" bindtap="showAddCategory">+ 新增分类</text>
        </view>
      </view>
      
      <!-- 菜品类型 -->
      <view class="form-group">
        <view class="form-label required">菜品类型</view>
        <radio-group class="radio-group" bindchange="onTypeChange">
          <label class="radio-item">
            <radio value="multi_serving" checked="{{formData.type === 'multi_serving'}}" />
            <text>多人份</text>
          </label>
          <label class="radio-item">
            <radio value="single_serving" checked="{{formData.type === 'single_serving'}}" />
            <text>一人份</text>
          </label>
        </radio-group>
      </view>
      
      <!-- 原材料列表 -->
      <view class="form-group">
        <view class="form-label required">原材料列表</view>
        <view class="ingredients-list">
          <view wx:for="{{formData.ingredients}}" wx:key="index" class="ingredient-item">
            <input 
              class="ingredient-input" 
              placeholder="原材料名称" 
              value="{{item.name}}" 
              data-index="{{index}}"
              bindinput="onIngredientNameChange"
            />
            <input 
              class="ingredient-quantity" 
              placeholder="数量(可选)" 
              value="{{item.quantity}}" 
              data-index="{{index}}"
              bindinput="onIngredientQuantityChange"
            />
            <view class="ingredient-remove" bindtap="removeIngredient" data-index="{{index}}">✕</view>
          </view>
        </view>
        <view class="add-ingredient-btn" bindtap="addIngredient">
          <text class="add-icon">+</text>
          <text>添加原材料</text>
        </view>
      </view>
      
      <!-- 制作方法 -->
      <view class="form-group">
        <view class="form-label required">制作方法</view>
        <textarea 
          class="form-textarea" 
          placeholder="请输入制作方法，每个步骤一行&#10;例如：&#10;1. 鸡肉切丁，腌制&#10;2. 热油爆香葱姜蒜&#10;3. 加入鸡丁翻炒" 
          value="{{formData.cooking_method}}" 
          bindinput="onInputCookingMethod"
          maxlength="1000"
          auto-height
        />
      </view>
      
      <!-- 备注 -->
      <view class="form-group">
        <view class="form-label">备注</view>
        <textarea 
          class="form-textarea" 
          placeholder="请输入备注信息（可选）" 
          value="{{formData.notes}}" 
          bindinput="onInputNotes"
          maxlength="200"
        />
      </view>
      
      <!-- 提交按钮 -->
      <view class="submit-section">
        <button class="btn-primary submit-btn" bindtap="submitForm">确认添加</button>
      </view>
    </view>
  </scroll-view>
  
  <!-- 新增分类弹窗 -->
  <view wx:if="{{showCategoryDialog}}" class="modal-overlay" bindtap="hideCategoryDialog">
    <view class="modal-content small" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-title">新增分类</view>
        <view class="modal-close" bindtap="hideCategoryDialog">✕</view>
      </view>
      
      <view class="modal-body">
        <input 
          class="form-input" 
          placeholder="请输入分类名称" 
          value="{{newCategory}}" 
          bindinput="onInputNewCategory"
          maxlength="20"
        />
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideCategoryDialog">取消</button>
        <button class="btn-primary" bindtap="confirmAddCategory">确认</button>
      </view>
    </view>
  </view>
</view>


