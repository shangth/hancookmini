<view class="container">
  <!-- 自定义导航栏 -->
  <navigation-bar title="{{gathering.name}}" show-back="{{true}}" />
  
  <!-- 聚会信息 -->
  <view class="gathering-header">
    <view class="header-info">
      <text class="info-text">📅 {{formatDate(gathering.time)}}</text>
      <text class="info-text">📍 {{gathering.location}}</text>
    </view>
    <view class="header-status">
      <view class="tag {{gathering.menu_locked ? 'tag-danger' : 'tag-success'}}">
        {{gathering.menu_locked ? '已锁定' : '未锁定'}}
      </view>
    </view>
  </view>
  
  <!-- 搜索框 -->
  <view class="search-bar">
    <view class="search-input">
      <text class="search-icon">🔍</text>
      <input placeholder="搜索菜品或原材料" value="{{searchKeyword}}" bindinput="onSearch" />
      <text wx:if="{{searchKeyword}}" class="clear-icon" bindtap="clearSearch">✕</text>
    </view>
  </view>
  
  <!-- 主体内容区 -->
  <view class="main-content">
    <!-- 左侧分类导航 -->
    <view class="category-sidebar">
      <scroll-view scroll-y class="category-list">
        <view 
          wx:for="{{categories}}" 
          wx:key="*this" 
          class="category-item {{currentCategory === item ? 'active' : ''}}"
          bindtap="selectCategory"
          data-category="{{item}}"
        >
          {{item}}
        </view>
      </scroll-view>
    </view>
    
    <!-- 右侧菜品列表 -->
    <scroll-view scroll-y class="dishes-container" bindscroll="onScroll" scroll-into-view="{{scrollIntoView}}">
      <!-- 推荐菜品 -->
      <view wx:if="{{!searchKeyword && recommendedDishes.length > 0}}" id="category-推荐" class="dish-section">
        <view class="section-title">🔥 为你推荐</view>
        <scroll-view scroll-x class="recommend-scroll">
          <view class="recommend-list">
            <view 
              wx:for="{{recommendedDishes}}" 
              wx:key="id" 
              class="recommend-card"
              bindtap="toggleLike"
              data-dish-id="{{item.dish.id}}"
            >
              <image class="recommend-image" src="{{item.dish.image_url}}" mode="aspectFill" />
              <view class="recommend-info">
                <view class="recommend-name">{{item.dish.name}}</view>
                <view class="recommend-type">{{item.dish.type === 'multi_serving' ? '多人份' : '一人份'}}</view>
              </view>
              <view class="recommend-like {{item.isLiked ? 'liked' : ''}}">
                <text class="like-icon">{{item.isLiked ? '❤️' : '🤍'}}</text>
                <text class="like-count">{{item.likeCount}}</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>
      
      <!-- 菜品分类列表 -->
      <view wx:for="{{displayDishes}}" wx:key="category" id="category-{{item.category}}" class="dish-section">
        <view class="section-title">{{item.category}}</view>
        <view class="dish-list">
          <view 
            wx:for="{{item.dishes}}" 
            wx:for-item="dishItem" 
            wx:key="id" 
            class="dish-card"
          >
            <image class="dish-image" src="{{dishItem.dish.image_url}}" mode="aspectFill" />
            <view class="dish-info">
              <view class="dish-name">{{dishItem.dish.name}}</view>
              <view class="dish-meta">
                <view class="dish-type">{{dishItem.dish.type === 'multi_serving' ? '多人份' : '一人份'}}</view>
              </view>
              <view class="dish-likes">
                <view class="liked-users">
                  <view wx:for="{{dishItem.likedUsers.slice(0, 5)}}" wx:for-item="user" wx:key="id" class="user-avatar">
                    <image src="{{user.avatar}}" mode="aspectFill" />
                  </view>
                  <text wx:if="{{dishItem.likeCount > 5}}" class="more-users">+{{dishItem.likeCount - 5}}</text>
                </view>
              </view>
            </view>
            <view class="dish-actions">
              <view 
                class="like-btn {{dishItem.isLiked ? 'liked' : ''}}"
                bindtap="toggleLike"
                data-dish-id="{{dishItem.dish.id}}"
              >
                <text class="like-icon">{{dishItem.isLiked ? '❤️' : '🤍'}}</text>
                <text class="like-count">{{dishItem.likeCount}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 空状态 -->
      <view wx:if="{{displayDishes.length === 0 && !searchKeyword}}" class="empty-state">
        <view class="empty-state-icon">🍽️</view>
        <view class="empty-state-text">暂无菜品</view>
      </view>
      
      <!-- 搜索无结果 -->
      <view wx:if="{{displayDishes.length === 0 && searchKeyword}}" class="empty-state">
        <view class="empty-state-icon">🔍</view>
        <view class="empty-state-text">未找到相关菜品</view>
      </view>
    </scroll-view>
  </view>
  
  <!-- 底部用户信息栏 -->
  <view class="bottom-bar">
    <view class="user-info">
      <image class="user-avatar" src="{{currentUser.avatar}}" mode="aspectFill" />
      <text class="user-name">{{currentUser.nickname}}</text>
    </view>
    <view class="order-btn" bindtap="showLikedList">
      <text class="order-icon">📋</text>
      <text wx:if="{{myLikedCount > 0}}" class="badge">{{myLikedCount}}</text>
    </view>
  </view>
  
  <!-- 点赞列表抽屉 -->
  <view wx:if="{{showDrawer}}" class="drawer-overlay" bindtap="hideDrawer">
    <view class="drawer-content" catchtap="stopPropagation">
      <view class="drawer-header">
        <view class="drawer-title">点赞列表</view>
        <view class="drawer-tabs">
          <view 
            class="drawer-tab {{drawerTab === 'all' ? 'active' : ''}}"
            bindtap="switchDrawerTab"
            data-tab="all"
          >
            全部 ({{allLikedDishes.length}})
          </view>
          <view 
            class="drawer-tab {{drawerTab === 'my' ? 'active' : ''}}"
            bindtap="switchDrawerTab"
            data-tab="my"
          >
            我的 ({{myLikedDishes.length}})
          </view>
        </view>
        <view class="drawer-close" bindtap="hideDrawer">✕</view>
      </view>
      
      <scroll-view scroll-y class="drawer-body">
        <view wx:for="{{currentDrawerList}}" wx:key="id" class="drawer-dish-item">
          <image class="drawer-dish-image" src="{{item.dish.image_url}}" mode="aspectFill" />
          <view class="drawer-dish-info">
            <view class="drawer-dish-name">{{item.dish.name}}</view>
            <view class="drawer-dish-type">{{item.dish.type === 'multi_serving' ? '多人份' : '一人份'}}</view>
            <view class="drawer-dish-users">
              <text wx:for="{{item.likedUsers}}" wx:for-item="user" wx:key="id" class="user-tag">
                {{user.nickname}}
              </text>
            </view>
          </view>
          <view class="drawer-dish-count">{{item.likeCount}}人</view>
        </view>
        
        <view wx:if="{{currentDrawerList.length === 0}}" class="empty-state">
          <view class="empty-state-icon">📋</view>
          <view class="empty-state-text">暂无点赞</view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>

