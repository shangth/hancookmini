<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <navigation-bar title="{{gathering.name}}" show-back="{{true}}" />
  
  <!-- èšä¼šä¿¡æ¯ -->
  <view class="gathering-header">
    <view class="header-info">
      <text class="info-text">ğŸ“… {{formatDate(gathering.time)}}</text>
      <text class="info-text">ğŸ“ {{gathering.location}}</text>
    </view>
    <view class="header-status">
      <view class="tag {{gathering.menu_locked ? 'tag-danger' : 'tag-success'}}">
        {{gathering.menu_locked ? 'å·²é”å®š' : 'æœªé”å®š'}}
      </view>
    </view>
  </view>
  
  <!-- æœç´¢æ¡† -->
  <view class="search-bar">
    <view class="search-input">
      <text class="search-icon">ğŸ”</text>
      <input placeholder="æœç´¢èœå“æˆ–åŸææ–™" value="{{searchKeyword}}" bindinput="onSearch" />
      <text wx:if="{{searchKeyword}}" class="clear-icon" bindtap="clearSearch">âœ•</text>
    </view>
  </view>
  
  <!-- ä¸»ä½“å†…å®¹åŒº -->
  <view class="main-content">
    <!-- å·¦ä¾§åˆ†ç±»å¯¼èˆª -->
    <view class="category-sidebar">
      <scroll-view scroll-y class="category-list">
        <view 
          wx:for="{{categories}}" 
          wx:key="*this" 
          class="category-item {{currentCategory === item ? 'active' : ''}}"
          bindtap="selectCategory"
          data-category="{{item}}"
        >
          {{item}}
        </view>
      </scroll-view>
    </view>
    
    <!-- å³ä¾§èœå“åˆ—è¡¨ -->
    <scroll-view scroll-y class="dishes-container" bindscroll="onScroll" scroll-into-view="{{scrollIntoView}}">
      <!-- æ¨èèœå“ -->
      <view wx:if="{{!searchKeyword && recommendedDishes.length > 0}}" id="category-æ¨è" class="dish-section">
        <view class="section-title">ğŸ”¥ ä¸ºä½ æ¨è</view>
        <scroll-view scroll-x class="recommend-scroll">
          <view class="recommend-list">
            <view 
              wx:for="{{recommendedDishes}}" 
              wx:key="id" 
              class="recommend-card"
              bindtap="toggleLike"
              data-dish-id="{{item.dish.id}}"
            >
              <image class="recommend-image" src="{{item.dish.image_url}}" mode="aspectFill" />
              <view class="recommend-info">
                <view class="recommend-name">{{item.dish.name}}</view>
                <view class="recommend-type">{{item.dish.type === 'multi_serving' ? 'å¤šäººä»½' : 'ä¸€äººä»½'}}</view>
              </view>
              <view class="recommend-like {{item.isLiked ? 'liked' : ''}}">
                <text class="like-icon">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
                <text class="like-count">{{item.likeCount}}</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>
      
      <!-- èœå“åˆ†ç±»åˆ—è¡¨ -->
      <view wx:for="{{displayDishes}}" wx:key="category" id="category-{{item.category}}" class="dish-section">
        <view class="section-title">{{item.category}}</view>
        <view class="dish-list">
          <view 
            wx:for="{{item.dishes}}" 
            wx:for-item="dishItem" 
            wx:key="id" 
            class="dish-card"
          >
            <image class="dish-image" src="{{dishItem.dish.image_url}}" mode="aspectFill" />
            <view class="dish-info">
              <view class="dish-name">{{dishItem.dish.name}}</view>
              <view class="dish-meta">
                <view class="dish-type">{{dishItem.dish.type === 'multi_serving' ? 'å¤šäººä»½' : 'ä¸€äººä»½'}}</view>
              </view>
              <view class="dish-likes">
                <view class="liked-users">
                  <view wx:for="{{dishItem.likedUsers.slice(0, 5)}}" wx:for-item="user" wx:key="id" class="user-avatar">
                    <image src="{{user.avatar}}" mode="aspectFill" />
                  </view>
                  <text wx:if="{{dishItem.likeCount > 5}}" class="more-users">+{{dishItem.likeCount - 5}}</text>
                </view>
              </view>
            </view>
            <view class="dish-actions">
              <view 
                class="like-btn {{dishItem.isLiked ? 'liked' : ''}}"
                bindtap="toggleLike"
                data-dish-id="{{dishItem.dish.id}}"
              >
                <text class="like-icon">{{dishItem.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
                <text class="like-count">{{dishItem.likeCount}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{displayDishes.length === 0 && !searchKeyword}}" class="empty-state">
        <view class="empty-state-icon">ğŸ½ï¸</view>
        <view class="empty-state-text">æš‚æ— èœå“</view>
      </view>
      
      <!-- æœç´¢æ— ç»“æœ -->
      <view wx:if="{{displayDishes.length === 0 && searchKeyword}}" class="empty-state">
        <view class="empty-state-icon">ğŸ”</view>
        <view class="empty-state-text">æœªæ‰¾åˆ°ç›¸å…³èœå“</view>
      </view>
    </scroll-view>
  </view>
  
  <!-- åº•éƒ¨ç”¨æˆ·ä¿¡æ¯æ  -->
  <view class="bottom-bar">
    <view class="user-info">
      <image class="user-avatar" src="{{currentUser.avatar}}" mode="aspectFill" />
      <text class="user-name">{{currentUser.nickname}}</text>
    </view>
    <view class="order-btn" bindtap="showLikedList">
      <text class="order-icon">ğŸ“‹</text>
      <text wx:if="{{myLikedCount > 0}}" class="badge">{{myLikedCount}}</text>
    </view>
  </view>
  
  <!-- ç‚¹èµåˆ—è¡¨æŠ½å±‰ -->
  <view wx:if="{{showDrawer}}" class="drawer-overlay" bindtap="hideDrawer">
    <view class="drawer-content" catchtap="stopPropagation">
      <view class="drawer-header">
        <view class="drawer-title">ç‚¹èµåˆ—è¡¨</view>
        <view class="drawer-tabs">
          <view 
            class="drawer-tab {{drawerTab === 'all' ? 'active' : ''}}"
            bindtap="switchDrawerTab"
            data-tab="all"
          >
            å…¨éƒ¨ ({{allLikedDishes.length}})
          </view>
          <view 
            class="drawer-tab {{drawerTab === 'my' ? 'active' : ''}}"
            bindtap="switchDrawerTab"
            data-tab="my"
          >
            æˆ‘çš„ ({{myLikedDishes.length}})
          </view>
        </view>
        <view class="drawer-close" bindtap="hideDrawer">âœ•</view>
      </view>
      
      <scroll-view scroll-y class="drawer-body">
        <view wx:for="{{currentDrawerList}}" wx:key="id" class="drawer-dish-item">
          <image class="drawer-dish-image" src="{{item.dish.image_url}}" mode="aspectFill" />
          <view class="drawer-dish-info">
            <view class="drawer-dish-name">{{item.dish.name}}</view>
            <view class="drawer-dish-type">{{item.dish.type === 'multi_serving' ? 'å¤šäººä»½' : 'ä¸€äººä»½'}}</view>
            <view class="drawer-dish-users">
              <text wx:for="{{item.likedUsers}}" wx:for-item="user" wx:key="id" class="user-tag">
                {{user.nickname}}
              </text>
            </view>
          </view>
          <view class="drawer-dish-count">{{item.likeCount}}äºº</view>
        </view>
        
        <view wx:if="{{currentDrawerList.length === 0}}" class="empty-state">
          <view class="empty-state-icon">ğŸ“‹</view>
          <view class="empty-state-text">æš‚æ— ç‚¹èµ</view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>

